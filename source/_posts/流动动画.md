---
title: SVG管道流体动画实现
date: 2025-09-30
categories: 
  - 杂文
  - 推荐
tags: [SVG, 动画, CSS, JavaScript]
---

# SVG管道流体动画实现

本文介绍如何使用SVG、CSS动画和JavaScript创建一个交互式的管道流体动画效果。

## 效果概述

这个动画模拟了液体在管道中流动的效果，包含以下特性：
- 红色和蓝色液体在不同管道段流动
- 虚线动画模拟流动效果
- 点击阀门可以停止流体流动
- 发光效果增强视觉体验

## 代码实现

### HTML结构

```html
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="800" width="800">
    <!-- 管道轮廓 -->
    <polyline class="pipeline" points="10,10 10,200 200,200 200,400 400,400 400,600" 
              style="fill:none;stroke:gray;stroke-width:10" />
    
    <!-- 第一段路径 -->
    <path class="water" id="water" d="M10,10 L10,200 L200,200" />
    
    <!-- 第二段路径 -->
    <path class="water2" id="water2" d="M200,200 L200,400 L400,400 L400,600" />
    
    <rect id="key" width="20" height="20" x="190" y="190" 
          style="fill:gray;stroke-width:1;stroke:rgb(0,0,0)" />
    <text style="fill:black;" x="220" y="190" font-size="20">点击阀门</text>
</svg>
```

### CSS动画演示

```css
.water {
    stroke-dasharray: 5,5; /* 创建虚线效果 */
    stroke-dashoffset: 1000;
    animation: dash 15s linear infinite;
    stroke:red;
    stroke-width:5;
    stroke-linejoin: round;
    fill:none;
    filter: drop-shadow(0 0);
}

.water2 {
    stroke-dasharray: 1000;  /* 创建虚线效果 */
    stroke-dashoffset: 1000;  /*偏移*/
    stroke:blue;
    stroke-width:5;
    animation: dash 15s linear infinite; /*动画*/
    stroke-linejoin: round;
    fill:none;
}

.stop {
    stroke-dasharray: 50,10; /* 创建虚线效果 */
    stroke-dashoffset: 1000;
    animation: run 15s linear infinite;
    stroke:#ffff00;
    stroke-width:5;
    stroke-linejoin: round;
    fill:none;
    filter: drop-shadow(0 0 2px #ffff00) drop-shadow(0 0 2px rgba(255,255,0,0.5)); /*发光效果*/
}

/*关键帧*/
@keyframes dash {
    to {
        stroke-dashoffset: 0;
    }
}

@keyframes run {
    from {
        stroke-dasharray: 10, 5;
    }
    to {
        stroke-dasharray: 40, 5;
    }
}
```

### JavaScript交互

```js
var keybtn = document.querySelector('#key');
var water1 = document.querySelector('#water');
var water2 = document.querySelector('#water2');

keybtn.addEventListener("click", function(){    
    water1.className.baseVal = "stop";
    water2.className.baseVal = "stop";
}, false);
```

## 技术要点

### 1. SVG路径动画

使用`stroke-dasharray`和`stroke-dashoffset`属性结合CSS动画创建流动效果。

#### `stroke-dasharray`

- **作用**：创建虚线效果

- **语法**：`stroke-dasharray: 实线长度, 间隔长度, 实线长度, 间隔长度...`

- **示例**：

  ```css
  stroke-dasharray: 5,5    /* 5像素实线，5像素间隔 */
  stroke-dasharray: 10,5,5,5  /* 10像素实线，5像素间隔，5像素实线，5像素间隔 */
  stroke-dasharray: 1000    /* 1000像素实线（无间隔） */
  ```

#### `stroke-dashoffset`

- **作用**：控制虚线图案的起始偏移量

- **语法**：`stroke-dashoffset: 数值`

- **示例**：

  ```css
  stroke-dashoffset: 1000  /* 虚线图案从1000像素处开始 */
  ```

  

####  `stroke`

- **作用**：设置线条颜色

- **语法**：`stroke: 颜色值`

- **示例**：

  ```css
  stroke: blue
  stroke: #ff0000
  stroke: rgb(255,0,0)
  ```

#### `stroke-width`

- **作用**：设置线条粗细

- **语法**：`stroke-width: 数值`

- **示例**：

  ```css
  stroke-width: 5    /* 5像素粗的线条 */
  ```

### 2. CSS动画属性及关键帧动画


- `animation`: 动画属性
- `@keyframes dash`: 控制虚线偏移，实现连续流动效果
- `@keyframes run`: 控制停止状态下的虚线样式变化

#### `animation`

- **作用**：简写属性，包含所有动画设置

- **语法**：`animation: 名称 时长 时序函数 延迟 次数 方向 填充模式 播放状态`

- **示例**：

  ```css
  animation: dash 20s linear infinite
  /* 等同于：
     animation-name: dash
     animation-duration: 20s
     animation-timing-function: linear
     animation-iteration-count: infinite
  */
  ```

#### `@keyframes`

- **作用**：定义动画的关键帧序列

- **语法**：

  ```css
  @keyframes 动画名称 {
    from { /* 起始状态 */ }
    to { /* 结束状态 */ }
  }
  
  /* 或使用百分比 */
  @keyframes 动画名称 {
    0% { /* 0%时的状态 */ }
    50% { /* 50%时的状态 */ }
    100% { /* 100%时的状态 */ }
  }
  ```

### 3. 交互功能

通过JavaScript监听点击事件，动态修改CSS类名来改变动画状态。

### 4. 视觉效果

- 使用`filter: drop-shadow`创建发光效果
- 不同颜色区分不同流体段
- 圆角连接使管道看起来更自然

## 应用场景

这种动画效果可用于：

- 工业流程演示
- 数据流动可视化
- 教学演示材料
- 交互式图表

## 扩展建议

1. **添加更多交互**：可以增加开始、暂停、重置等功能
2. **颜色自定义**：通过CSS变量实现动态颜色切换
3. **响应式设计**：使SVG适应不同屏幕尺寸
4. **性能优化**：对于复杂动画可以考虑使用requestAnimationFrame